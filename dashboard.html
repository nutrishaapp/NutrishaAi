<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutrishaAI Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #f093fb;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #3498db;
            --sidebar-width: 280px;
            --header-height: 70px;
            --border-radius: 12px;
            --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark-color);
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            z-index: 1000;
            overflow-y: auto;
            transition: var(--transition);
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transition: var(--transition);
        }

        .sidebar.collapsed .logo-text {
            display: none;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            margin: 5px 15px;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            color: var(--dark-color);
            text-decoration: none;
            transition: var(--transition);
            border-radius: var(--border-radius);
        }

        .nav-link:hover, .nav-link.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            transform: translateX(5px);
        }

        .nav-icon {
            width: 20px;
            text-align: center;
            font-size: 18px;
        }

        .nav-text {
            transition: var(--transition);
        }

        .sidebar.collapsed .nav-text {
            display: none;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
        }

        .sidebar.collapsed ~ .main-content {
            margin-left: 80px;
        }

        /* Header */
        .header {
            height: var(--header-height);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            position: sticky;
            top: 0;
            z-index: 999;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--dark-color);
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: var(--transition);
        }

        .sidebar-toggle:hover {
            background: var(--light-color);
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark-color);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 300px;
            padding: 12px 45px 12px 20px;
            border: 2px solid transparent;
            border-radius: 25px;
            background: var(--light-color);
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 25px;
            transition: var(--transition);
        }

        .user-profile:hover {
            background: var(--light-color);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .user-info h4 {
            font-size: 14px;
            margin-bottom: 2px;
        }

        .user-info p {
            font-size: 12px;
            color: #666;
        }

        /* Content Area */
        .content {
            padding: 30px;
            background: transparent;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .stat-title {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .stat-icon.users {
            background: linear-gradient(135deg, var(--info-color), #5dade2);
        }

        .stat-icon.plans {
            background: linear-gradient(135deg, var(--success-color), #58d68d);
        }

        .stat-icon.messages {
            background: linear-gradient(135deg, var(--warning-color), #f7dc6f);
        }

        .stat-icon.revenue {
            background: linear-gradient(135deg, var(--danger-color), #ec7063);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 5px;
        }

        .stat-change {
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-change.positive {
            color: var(--success-color);
        }

        .stat-change.negative {
            color: var(--danger-color);
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        /* Chart Container */
        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chart-header {
            display: flex;
            align-items: center;
            justify-content: between;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .chart-placeholder {
            height: 300px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 16px;
            border: 2px dashed #ddd;
        }

        /* Activity Feed */
        .activity-feed {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .activity-header {
            display: flex;
            align-items: center;
            justify-content: between;
            margin-bottom: 20px;
        }

        .activity-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .activity-item:hover {
            background: var(--light-color);
        }

        .activity-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            font-size: 14px;
            margin-bottom: 4px;
        }

        .activity-time {
            font-size: 12px;
            color: #666;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .action-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-decoration: none;
            color: inherit;
        }

        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow);
        }

        .action-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: white;
            font-size: 24px;
        }

        .action-icon.create-user {
            background: linear-gradient(135deg, var(--info-color), #5dade2);
        }

        .action-icon.create-plan {
            background: linear-gradient(135deg, var(--success-color), #58d68d);
        }

        .action-icon.view-analytics {
            background: linear-gradient(135deg, var(--warning-color), #f7dc6f);
        }

        .action-icon.settings {
            background: linear-gradient(135deg, var(--danger-color), #ec7063);
        }

        .action-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .action-description {
            font-size: 14px;
            color: #666;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: var(--sidebar-width);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .search-input {
                width: 200px;
            }

            .user-info {
                display: none;
            }
        }

        /* Animations */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .stat-card, .chart-container, .activity-feed, .action-card {
            animation: slideInUp 0.6s ease-out forwards;
        }

        .stat-card:nth-child(2) { animation-delay: 0.1s; }
        .stat-card:nth-child(3) { animation-delay: 0.2s; }
        .stat-card:nth-child(4) { animation-delay: 0.3s; }

        /* Loading States */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid var(--primary-color);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Conversations Styles */
        .conversations-container {
            padding: 20px;
        }

        .conversations-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        /* Users Styles */
        .users-container {
            padding: 20px;
        }

        .users-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .users-title {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .users-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .users-search {
            position: relative;
        }

        .user-search-input {
            width: 300px;
            padding: 12px 45px 12px 20px;
            border: 2px solid #e0e6ed;
            border-radius: 25px;
            background: white;
            transition: var(--transition);
        }

        .user-search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .refresh-users-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .refresh-users-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .user-stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .user-stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: var(--transition);
        }

        .user-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .stat-icon.patients {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .stat-icon.nutritionists {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }

        .stat-icon.admins {
            background: linear-gradient(135deg, #fa709a, #fee140);
        }

        .stat-details {
            flex: 1;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .users-table-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            overflow-x: auto;
        }

        .users-table {
            width: 100%;
            border-collapse: collapse;
        }

        .users-table thead th {
            text-align: left;
            padding: 12px;
            border-bottom: 2px solid #e0e6ed;
            color: #666;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
        }

        .users-table tbody td {
            padding: 15px 12px;
            border-bottom: 1px solid #f0f3f7;
        }

        .users-table tbody tr:hover {
            background: #f8f9fa;
        }

        .user-role-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .role-patient {
            background: #e3f2fd;
            color: #1976d2;
        }

        .role-nutritionist {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .role-admin {
            background: #fff3e0;
            color: #f57c00;
        }

        .user-actions-btns {
            display: flex;
            gap: 10px;
        }

        .user-action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .make-admin-btn {
            background: #fff3e0;
            color: #f57c00;
        }

        .make-admin-btn:hover {
            background: #f57c00;
            color: white;
        }

        .remove-admin-btn {
            background: #ffebee;
            color: #c62828;
        }

        .remove-admin-btn:hover {
            background: #c62828;
            color: white;
        }

        .delete-user-btn {
            background: #ffebee;
            color: #d32f2f;
        }

        .delete-user-btn:hover {
            background: #d32f2f;
            color: white;
        }

        /* Documents Styles */
        .documents-container {
            padding: 20px;
        }

        .documents-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .documents-title {
            font-size: 24px;
            font-weight: 600;
            color: white;
        }

        .new-document-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .new-document-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .upload-section {
            margin-bottom: 30px;
        }

        .upload-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark-color);
        }

        .form-input {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .documents-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .document-list-item {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 20px 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid rgba(0, 0, 0, 0.06);
        }

        .document-list-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.15);
            border-color: rgba(102, 126, 234, 0.2);
        }

        .document-list-left {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 1;
        }

        .document-icon {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            color: white;
            font-size: 20px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .document-info {
            flex: 1;
        }

        .document-info h3 {
            font-size: 17px;
            font-weight: 600;
            color: #1a1a2e;
            margin: 0 0 6px 0;
            display: inline-block;
            letter-spacing: -0.02em;
        }

        .document-type-badge {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-left: 10px;
        }

        .document-type-badge.workout-plan {
            background: linear-gradient(135deg, #667eea20, #764ba220);
            color: #667eea;
            border: 1px solid #667eea30;
        }

        .document-type-badge.diet-plan {
            background: linear-gradient(135deg, #10b98120, #05966920);
            color: #059669;
            border: 1px solid #10b98130;
        }

        .document-type-badge.other {
            background: #f3f4f6;
            color: #6b7280;
            border: 1px solid #e5e7eb;
        }

        .document-description {
            color: #6b7280;
            font-size: 14px;
            margin: 0 0 8px 0;
            line-height: 1.5;
        }

        .document-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 13px;
            color: #9ca3af;
        }

        .document-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .document-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }

        .document-tags .tag {
            padding: 3px 10px;
            background: #f9fafb;
            color: #6b7280;
            border: 1px solid #e5e7eb;
            border-radius: 14px;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .document-tags .tag:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        .document-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .document-actions .icon-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
            position: relative;
        }

        .document-actions .icon-btn:hover {
            transform: translateY(-2px);
        }

        .document-actions .icon-btn.view {
            background: #f3f4f6;
            color: #6b7280;
        }

        .document-actions .icon-btn.view:hover {
            background: #e5e7eb;
            color: #4b5563;
        }

        .document-actions .icon-btn.edit {
            background: #fef3c7;
            color: #f59e0b;
        }

        .document-actions .icon-btn.edit:hover {
            background: #fed7aa;
            color: #ea580c;
        }

        .document-actions .icon-btn.download {
            background: #dbeafe;
            color: #3b82f6;
        }

        .document-actions .icon-btn.download:hover {
            background: #bfdbfe;
            color: #2563eb;
        }

        .document-actions .icon-btn.delete {
            background: #fee2e2;
            color: #ef4444;
        }

        .document-actions .icon-btn.delete:hover {
            background: #fecaca;
            color: #dc2626;
        }

        .document-actions .icon-btn[data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 44px;
            left: 50%;
            transform: translateX(-50%);
            background: #1a1a2e;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            pointer-events: none;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: var(--dark-color);
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: var(--dark-color);
        }

        .conversations-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .new-conversation-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .new-conversation-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .conversations-list {
            display: grid;
            gap: 15px;
        }

        .conversation-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .conversation-card:hover {
            transform: translateX(5px);
            box-shadow: var(--box-shadow);
        }

        .conversation-info {
            flex: 1;
        }

        .conversation-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 8px;
        }

        .conversation-preview {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .conversation-meta {
            display: flex;
            gap: 20px;
            font-size: 12px;
            color: #999;
        }

        .conversation-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .conversation-status.active {
            background: rgba(39, 174, 96, 0.1);
            color: var(--success-color);
        }

        .conversation-status.archived {
            background: rgba(153, 153, 153, 0.1);
            color: #999;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state-icon {
            font-size: 64px;
            color: #ddd;
            margin-bottom: 20px;
        }

        .empty-state-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 10px;
        }

        .empty-state-text {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
        }

        /* Logout Button */
        .logout-btn {
            background: linear-gradient(135deg, var(--danger-color), #ec7063);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        /* App Config Styles */
        .app-config-container {
            padding: 20px;
        }

        .app-config-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .app-config-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .app-config-actions {
            display: flex;
            gap: 12px;
        }

        .reload-config-btn, .clear-cache-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .clear-cache-btn {
            background: linear-gradient(135deg, var(--warning-color), #f7dc6f);
        }

        .reload-config-btn:hover, .clear-cache-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .config-editor-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .config-selector {
            margin-bottom: 25px;
        }

        .config-select-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark-color);
            font-size: 16px;
        }

        .config-dropdown {
            width: 100%;
            max-width: 500px;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius);
            background: white;
            font-size: 14px;
            transition: var(--transition);
            cursor: pointer;
        }

        .config-dropdown:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .config-info {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            padding: 12px 16px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            font-size: 13px;
            color: #6c757d;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .config-editor {
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .editor-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .editor-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .editor-badge {
            padding: 4px 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .editor-body {
            padding: 20px;
            background: white;
        }

        .editor-body textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius);
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            min-height: 400px;
            transition: var(--transition);
        }

        .editor-body textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .char-counter {
            text-align: right;
            margin-top: 8px;
            font-size: 12px;
            color: #6c757d;
        }

        .editor-actions {
            padding: 20px;
            background: #f8f9fa;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            border-top: 1px solid #e9ecef;
        }

        .config-status {
            text-align: center;
            padding: 40px 20px;
        }

        .app-config-list {
            display: grid;
            gap: 20px;
        }

        .config-item {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }

        .config-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .config-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .config-key-info {
            flex: 1;
        }

        .config-key {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark-color);
            margin: 0 0 8px 0;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .config-key-badges {
            display: flex;
            gap: 8px;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-primary {
            background: rgba(102, 126, 234, 0.1);
            color: var(--primary-color);
        }

        .badge-warning {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning-color);
        }

        .badge-secondary {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }

        .config-actions {
            display: flex;
            gap: 8px;
            align-items: flex-start;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 8px;
            background: var(--light-color);
            color: var(--dark-color);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-icon:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn-icon.btn-danger:hover {
            background: var(--danger-color);
            color: white;
        }

        .config-preview {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
            color: #495057;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .config-meta {
            display: flex;
            gap: 20px;
            font-size: 12px;
            color: #6c757d;
        }

        .config-meta span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Config Modal */
        .config-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .config-modal-content {
            background: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .config-modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .config-modal-header h3 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
        }

        .config-modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .config-modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .config-modal-body {
            padding: 25px;
            flex: 1;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: var(--transition);
            font-family: inherit;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-control[readonly] {
            background: #f8f9fa;
            color: #6c757d;
        }

        .form-control textarea {
            font-family: 'Consolas', 'Monaco', monospace;
            resize: vertical;
            min-height: 300px;
        }

        .char-count {
            text-align: right;
            margin-top: 5px;
            font-size: 12px;
            color: #6c757d;
        }

        .config-meta {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #6c757d;
        }

        .config-modal-footer {
            padding: 20px 25px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background: #f8f9fa;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--box-shadow);
        }

        /* Loading and Error States */
        .loading-state, .error-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .loading-state i {
            font-size: 32px;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .error-state {
            color: var(--danger-color);
        }

        .error-state i {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .error-state h3 {
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: var(--border-radius);
            padding: 15px 20px;
            box-shadow: var(--box-shadow);
            z-index: 3000;
            animation: slideInRight 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: 300px;
            border-left: 4px solid;
        }

        .notification-success {
            border-left-color: var(--success-color);
            color: var(--success-color);
        }

        .notification-error {
            border-left-color: var(--danger-color);
            color: var(--danger-color);
        }

        .notification-warning {
            border-left-color: var(--warning-color);
            color: var(--warning-color);
        }

        .notification-info {
            border-left-color: var(--info-color);
            color: var(--info-color);
        }

        .notification-content {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification-close {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .notification-close:hover {
            background: #f0f0f0;
            color: #666;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(300px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Responsive for App Config */
        @media (max-width: 768px) {
            .app-config-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .app-config-actions {
                width: 100%;
                justify-content: flex-end;
            }

            .config-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .config-actions {
                align-self: flex-end;
            }

            .config-modal-content {
                width: 95%;
                margin: 20px;
                max-height: calc(100vh - 40px);
            }

            .config-meta {
                flex-direction: column;
                gap: 10px;
            }

            .notification {
                right: 10px;
                left: 10px;
                min-width: auto;
            }
        }

        /* Risha Editor Styles */
        .risha-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .risha-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .risha-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .risha-title i {
            color: var(--primary-color);
            font-size: 24px;
        }

        .risha-actions {
            display: flex;
            gap: 12px;
        }

        .save-risha-btn, .reset-risha-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            font-size: 14px;
        }

        .save-risha-btn {
            background: var(--primary-color);
            color: white;
        }

        .save-risha-btn:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }

        .save-risha-btn:disabled {
            background: #ccc !important;
            cursor: not-allowed;
            transform: none !important;
            opacity: 0.6;
        }

        .save-risha-btn:disabled:hover {
            background: #ccc !important;
            transform: none !important;
        }

        .reset-risha-btn {
            background: #6c757d;
            color: white;
        }

        .reset-risha-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .risha-editor-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .editor-toolbar {
            background: #f8f9fa;
            padding: 16px 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .editor-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .editor-label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 16px;
        }

        .char-count {
            font-size: 14px;
            color: var(--text-secondary);
            background: white;
            padding: 4px 12px;
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }

        .editor-controls {
            display: flex;
            gap: 8px;
        }

        .editor-btn {
            width: 36px;
            height: 36px;
            border: 1px solid #e9ecef;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            color: var(--text-secondary);
        }

        .editor-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .editor-wrapper {
            position: relative;
        }

        .risha-editor {
            width: 100%;
            min-height: 500px;
            padding: 24px;
            border: none;
            outline: none;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-primary);
            background: white;
            resize: vertical;
            transition: var(--transition);
        }

        .risha-editor:focus {
            box-shadow: inset 0 0 0 2px var(--primary-color);
        }

        .risha-editor::placeholder {
            color: var(--text-secondary);
            font-style: italic;
        }

        .editor-status {
            background: #f8f9fa;
            padding: 12px 20px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }

        .status-text {
            color: var(--text-secondary);
        }

        .last-saved {
            color: #28a745;
            font-weight: 500;
        }

        /* Loading state */
        .risha-editor.loading {
            background: #f8f9fa;
            color: var(--text-secondary);
        }

        /* Success state */
        .risha-editor.saved {
            box-shadow: inset 0 0 0 2px #28a745;
        }

        /* Error state */
        .risha-editor.error {
            box-shadow: inset 0 0 0 2px #dc3545;
        }

        @media (max-width: 768px) {
            .risha-container {
                padding: 15px;
            }

            .risha-header {
                flex-direction: column;
                gap: 16px;
                align-items: stretch;
            }

            .risha-actions {
                justify-content: center;
            }

            .editor-toolbar {
                flex-direction: column;
                gap: 12px;
                padding: 12px 16px;
            }

            .editor-info {
                justify-content: space-between;
                width: 100%;
            }

            .risha-editor {
                min-height: 400px;
                padding: 16px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">N</div>
                <div class="logo-text">NutrishaAI</div>
            </div>
            
            <nav class="nav-menu">
                <div class="nav-item">
                    <a href="#" class="nav-link active" data-tab="conversations">
                        <i class="nav-icon fas fa-comments"></i>
                        <span class="nav-text">Conversations</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-tab="risha">
                        <i class="nav-icon"></i>
                        <span class="nav-text">Risha</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-tab="app-config">
                        <i class="nav-icon fas fa-sliders-h"></i>
                        <span class="nav-text">App Config</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-tab="users">
                        <i class="nav-icon fas fa-users"></i>
                        <span class="nav-text">Users</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-tab="documents">
                        <i class="nav-icon fas fa-file-alt"></i>
                        <span class="nav-text">Documents</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-tab="api-keys">
                        <i class="nav-icon fas fa-key"></i>
                        <span class="nav-text">API Keys</span>
                    </a>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="sidebar-toggle" id="sidebarToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="page-title" id="pageTitle">Conversations</h1>
                </div>
                
                <div class="header-right">
                    <div class="search-box">
                        <input type="text" class="search-input" placeholder="Search anything...">
                        <i class="search-icon fas fa-search"></i>
                    </div>
                    
                    <div class="user-profile" id="userProfile">
                        <div class="user-avatar" id="userAvatar">AD</div>
                        <div class="user-info">
                            <h4 id="userName">Admin User</h4>
                            <p id="userRole">Administrator</p>
                        </div>
                    </div>
                    
                    <button class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </button>
                </div>
            </header>

            <!-- Content -->
            <main class="content" id="mainContent">
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-title">Total Users</div>
                                <div class="stat-value">2,847</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i>
                                    +12% this month
                                </div>
                            </div>
                            <div class="stat-icon users">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-title">Active Plans</div>
                                <div class="stat-value">1,234</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i>
                                    +8% this month
                                </div>
                            </div>
                            <div class="stat-icon plans">
                                <i class="fas fa-utensils"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-title">Messages</div>
                                <div class="stat-value">45,678</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i>
                                    +24% this month
                                </div>
                            </div>
                            <div class="stat-icon messages">
                                <i class="fas fa-comments"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-title">Revenue</div>
                                <div class="stat-value">$89,432</div>
                                <div class="stat-change negative">
                                    <i class="fas fa-arrow-down"></i>
                                    -3% this month
                                </div>
                            </div>
                            <div class="stat-icon revenue">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Grid -->
                <div class="dashboard-grid">
                    <!-- Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">User Growth Analytics</h3>
                        </div>
                        <div class="chart-placeholder">
                            <i class="fas fa-chart-line" style="font-size: 48px; margin-right: 15px;"></i>
                            Chart Integration Ready - Connect your analytics data
                        </div>
                    </div>
                    
                    <!-- Activity Feed -->
                    <div class="activity-feed">
                        <div class="activity-header">
                            <h3 class="activity-title">Recent Activity</h3>
                        </div>
                        
                        <div class="activity-item">
                            <div class="activity-avatar">JD</div>
                            <div class="activity-content">
                                <div class="activity-text">John Doe created a new diet plan</div>
                                <div class="activity-time">2 minutes ago</div>
                            </div>
                        </div>
                        
                        <div class="activity-item">
                            <div class="activity-avatar">SM</div>
                            <div class="activity-content">
                                <div class="activity-text">Sarah Miller sent a message</div>
                                <div class="activity-time">15 minutes ago</div>
                            </div>
                        </div>
                        
                        <div class="activity-item">
                            <div class="activity-avatar">RJ</div>
                            <div class="activity-content">
                                <div class="activity-text">Robert Johnson updated profile</div>
                                <div class="activity-time">1 hour ago</div>
                            </div>
                        </div>
                        
                        <div class="activity-item">
                            <div class="activity-avatar">EM</div>
                            <div class="activity-content">
                                <div class="activity-text">Emma Martinez joined the platform</div>
                                <div class="activity-time">3 hours ago</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <a href="#" class="action-card">
                        <div class="action-icon create-user">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div class="action-title">Create User</div>
                        <div class="action-description">Add new users to the platform</div>
                    </a>
                    
                    <a href="#" class="action-card">
                        <div class="action-icon create-plan">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <div class="action-title">Create Diet Plan</div>
                        <div class="action-description">Design new nutrition plans</div>
                    </a>
                    
                    <a href="#" class="action-card">
                        <div class="action-icon view-analytics">
                            <i class="fas fa-analytics"></i>
                        </div>
                        <div class="action-title">View Analytics</div>
                        <div class="action-description">Detailed performance insights</div>
                    </a>
                    
                    <a href="#" class="action-card">
                        <div class="action-icon settings">
                            <i class="fas fa-sliders-h"></i>
                        </div>
                        <div class="action-title">System Settings</div>
                        <div class="action-description">Configure platform settings</div>
                    </a>
                </div>
            </main>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000';
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            initializeDashboard();
        });

        function checkAuth() {
            const token = localStorage.getItem('authToken');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            
            if (!token) {
                window.location.href = 'signin.html';
                return;
            }
            
            // Update user info in header
            if (user.fullName) {
                document.getElementById('userName').textContent = user.fullName;
                document.getElementById('userRole').textContent = user.role === 'admin' ? 'Administrator' : 'User';
                document.getElementById('userAvatar').textContent = user.fullName.split(' ').map(n => n[0]).join('').toUpperCase();
            }
        }

        function initializeDashboard() {
            // Sidebar toggle
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            
            sidebarToggle.addEventListener('click', function() {
                sidebar.classList.toggle('collapsed');
            });

            // Logout functionality
            const logoutBtn = document.getElementById('logoutBtn');
            logoutBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to logout?')) {
                    logout();
                }
            });

            // User profile dropdown (placeholder)
            const userProfile = document.getElementById('userProfile');
            userProfile.addEventListener('click', function() {
                // Add dropdown menu functionality here
                console.log('User profile clicked - add dropdown menu');
            });

            // Search functionality (placeholder)
            const searchInput = document.querySelector('.search-input');
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    console.log('Search for:', this.value);
                    // Add search functionality here
                }
            });

            // Navigation links
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all links
                    navLinks.forEach(l => l.classList.remove('active'));
                    
                    // Add active class to clicked link
                    this.classList.add('active');
                    
                    // Load content based on tab
                    const tab = this.getAttribute('data-tab');
                    if (tab) {
                        loadTabContent(tab);
                    }
                });
            });

            // Quick action cards
            const actionCards = document.querySelectorAll('.action-card');
            actionCards.forEach(card => {
                card.addEventListener('click', function(e) {
                    e.preventDefault();
                    const actionTitle = this.querySelector('.action-title').textContent;
                    console.log('Quick action:', actionTitle);
                    // Add action handling here
                });
            });

            // Store original dashboard content before switching tabs
            originalDashboardContent = document.getElementById('mainContent').innerHTML;
            tabContents.dashboard = originalDashboardContent;
            
            // Load initial content (Conversations)
            loadTabContent('conversations');
        }

        async function loadDashboardData() {
            try {
                // This would normally fetch real data from your API
                // For now, we'll simulate loading
                console.log('Loading dashboard data...');
                
                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Update stats with real data here
                console.log('Dashboard data loaded');
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        // Store original dashboard content
        let originalDashboardContent = '';
        
        // Tab content templates
        const tabContents = {
            conversations: `
                <div class="conversations-container">
                    <div class="conversations-header">
                        <h2 class="conversations-title">Your Conversations</h2>
                        <button class="new-conversation-btn" onclick="createNewConversation()">
                            <i class="fas fa-plus"></i>
                            New Conversation
                        </button>
                    </div>
                    <div class="conversations-list" id="conversationsList">
                        <!-- Conversations will be loaded here -->
                    </div>
                </div>
            `,
            risha: `
                <div class="risha-container">
                    <div class="risha-header">
                        <h2 class="risha-title">
                             Risha Personality
                        </h2>
                        <div class="risha-actions">
                            <button class="save-risha-btn" onclick="saveRishaPrompt()" id="saveRishaBtn" disabled>
                                 Save Changes
                            </button>
                            <button class="reset-risha-btn" onclick="loadRishaPrompt()">
                                 Reset
                            </button>
                        </div>
                    </div>
                    
                    <div class="risha-editor-container">
                        
                        <div class="editor-wrapper">
                            <textarea 
                                id="rishaPromptEditor" 
                                class="risha-editor"
                                placeholder="Enter Risha's system prompt here... This will define how Risha behaves and responds to users."
                                spellcheck="false"
                            ></textarea>
                        </div>
                        
                        <div class="editor-status" id="rishaEditorStatus">
                            <span class="status-text">Ready to edit</span>
                            <span class="last-saved" id="lastSaved"></span>
                        </div>
                    </div>
                </div>
            `,
            'app-config': `
                <div class="app-config-container">
                    <div class="app-config-header">
                        <h2 class="app-config-title">Application Configuration</h2>
                        <div class="app-config-actions">
                            <button class="reload-config-btn" onclick="loadAppConfigs()">
                                <i class="fas fa-sync-alt"></i>
                                Reload
                            </button>
                            <button class="clear-cache-btn" onclick="clearConfigCache()">
                                <i class="fas fa-trash"></i>
                                Clear Cache
                            </button>
                        </div>
                    </div>
                    
                    <div class="config-editor-container">
                        <!-- Config Selection Dropdown -->
                        <div class="config-selector">
                            <label for="configSelect" class="config-select-label">Select Configuration:</label>
                            <select id="configSelect" class="config-dropdown" onchange="onConfigSelect(this.value)">
                                <option value="">Select a configuration to edit...</option>
                            </select>
                            <div class="config-info" id="configInfo" style="display: none;">
                                <div class="info-item">
                                    <i class="fas fa-calendar"></i>
                                    <span>Created: <span id="configCreatedDate">-</span></span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-clock"></i>
                                    <span>Updated: <span id="configUpdatedDate">-</span></span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-font"></i>
                                    <span>Length: <span id="configLength">0</span> characters</span>
                                </div>
                            </div>
                        </div>

                        <!-- Config Editor -->
                        <div class="config-editor" id="configEditor" style="display: none;">
                            <div class="editor-header">
                                <h3 id="editorTitle">Edit Configuration</h3>
                                <div class="editor-badge" id="editorBadge"></div>
                            </div>
                            
                            <div class="editor-body">
                                <textarea id="configTextarea" rows="20" placeholder="Select a configuration to edit..."></textarea>
                                <div class="char-counter">
                                    <span id="charCounter">0</span> characters
                                </div>
                            </div>
                            
                            <div class="editor-actions">
                                <button class="btn btn-secondary" onclick="resetConfig()" id="resetBtn">
                                    <i class="fas fa-undo"></i>
                                    Reset
                                </button>
                                <button class="btn btn-primary" onclick="saveCurrentConfig()" id="saveBtn">
                                    <i class="fas fa-save"></i>
                                    Save Changes
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Loading/Error States -->
                    <div class="config-status" id="configStatus">
                        <div class="loading-state">
                            <i class="fas fa-spinner fa-spin"></i>
                            Loading configurations...
                        </div>
                    </div>
                </div>
            `,
            users: `
                <div class="users-container">
                    <div class="users-header">
                        <h2 class="users-title">User Management</h2>
                        <div class="users-actions">
                            <div class="users-search">
                                <input type="text" id="userSearch" class="user-search-input" placeholder="Search users..." onkeyup="searchUsers(this.value)">
                                <i class="fas fa-search search-icon"></i>
                            </div>
                            <button class="refresh-users-btn" onclick="loadUsers()">
                                <i class="fas fa-sync-alt"></i>
                                Refresh
                            </button>
                        </div>
                    </div>
                    
                    <!-- User Stats -->
                    <div class="user-stats-row" id="userStats">
                        <div class="user-stat-card">
                            <div class="stat-icon users">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-details">
                                <div class="stat-value" id="totalUsersCount">0</div>
                                <div class="stat-label">Total Users</div>
                            </div>
                        </div>
                        <div class="user-stat-card">
                            <div class="stat-icon patients">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="stat-details">
                                <div class="stat-value" id="patientsCount">0</div>
                                <div class="stat-label">Patients</div>
                            </div>
                        </div>
                        <div class="user-stat-card">
                            <div class="stat-icon nutritionists">
                                <i class="fas fa-user-md"></i>
                            </div>
                            <div class="stat-details">
                                <div class="stat-value" id="nutritionistsCount">0</div>
                                <div class="stat-label">Nutritionists</div>
                            </div>
                        </div>
                        <div class="user-stat-card">
                            <div class="stat-icon admins">
                                <i class="fas fa-user-shield"></i>
                            </div>
                            <div class="stat-details">
                                <div class="stat-value" id="adminsCount">0</div>
                                <div class="stat-label">Admins</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Users Table -->
                    <div class="users-table-container">
                        <table class="users-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Phone</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            `,
            documents: `
                <div class="documents-container">
                    <div class="documents-header">
                        <h2 class="documents-title">Document Management</h2>
                        <button class="new-document-btn" onclick="showUploadModal()">
                            <i class="fas fa-upload"></i>
                            Upload Document
                        </button>
                    </div>
                    
                    <!-- Upload Form -->
                    <div id="uploadSection" class="upload-section" style="display: none;">
                        <div class="upload-card">
                            <h3>Upload New Document</h3>
                            <form id="documentUploadForm" onsubmit="uploadDocument(event)">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="docName">Document Name *</label>
                                        <input type="text" id="docName" required class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label for="docType">Document Type *</label>
                                        <select id="docType" required class="form-input">
                                            <option value="">Select type</option>
                                            <option value="workout_plan">Workout Plan</option>
                                            <option value="diet_plan">Diet Plan</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="docDescription">Description</label>
                                    <textarea id="docDescription" rows="3" class="form-input"></textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="docTags">Tags (comma-separated)</label>
                                        <input type="text" id="docTags" class="form-input" placeholder="fitness, nutrition, health">
                                    </div>
                                    <div class="form-group">
                                        <label for="docVisibility">Visibility</label>
                                        <select id="docVisibility" class="form-input">
                                            <option value="false">Private</option>
                                            <option value="true">Public</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="docFile">Select File (PDF, Word, or Image) *</label>
                                    <input type="file" id="docFile" accept=".pdf,.docx,.jpg,.jpeg,.png,.gif,.webp" required class="form-input">
                                </div>
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="hideUploadModal()">Cancel</button>
                                    <button type="submit" class="btn btn-primary">Upload</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Edit Document Modal -->
                    <div id="editSection" class="upload-section" style="display: none;">
                        <div class="upload-card">
                            <h3>Edit Document</h3>
                            <form id="documentEditForm" onsubmit="updateDocument(event)">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editDocName">Document Name *</label>
                                        <input type="text" id="editDocName" required class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label for="editDocType">Document Type *</label>
                                        <select id="editDocType" required class="form-input">
                                            <option value="">Select type</option>
                                            <option value="workout_plan">Workout Plan</option>
                                            <option value="diet_plan">Diet Plan</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="editDocDescription">Description</label>
                                    <textarea id="editDocDescription" rows="3" class="form-input"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="editDocContent">Content</label>
                                    <textarea id="editDocContent" rows="8" class="form-input" placeholder="Document content (extracted from file or manually entered)"></textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editDocTags">Tags (comma-separated)</label>
                                        <input type="text" id="editDocTags" class="form-input" placeholder="fitness, nutrition, health">
                                    </div>
                                    <div class="form-group">
                                        <label for="editDocVisibility">Visibility</label>
                                        <select id="editDocVisibility" class="form-input">
                                            <option value="false">Private</option>
                                            <option value="true">Public</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="hideEditModal()">Cancel</button>
                                    <button type="submit" class="btn btn-primary">Update Document</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Documents List -->
                    <div class="documents-list" id="documentsList">
                        <!-- Documents will be loaded here -->
                    </div>
                </div>
            `
        };

        function loadTabContent(tab) {
            const mainContent = document.getElementById('mainContent');
            const pageTitle = document.getElementById('pageTitle');
            
            // Update page title
            const titles = {
                conversations: 'Conversations',
                'app-config': 'App Configuration',
                dashboard: 'Dashboard',
                users: 'Users',
                'diet-plans': 'Diet Plans',
                documents: 'Documents',
                analytics: 'Analytics',
                'api-keys': 'API Keys',
                settings: 'Settings'
            };
            
            pageTitle.textContent = titles[tab] || 'Dashboard';
            
            // Load content
            if (tabContents[tab]) {
                mainContent.innerHTML = tabContents[tab];
                
                // Load conversations if on conversations tab
                if (tab === 'conversations') {
                    loadConversations();
                }
                // Load Risha prompt if on risha tab
                else if (tab === 'risha') {
                    loadRishaPrompt();
                    setupRishaEditor();
                }
                // Load app configs if on app-config tab
                else if (tab === 'app-config') {
                    loadAppConfigs();
                }
                // Load documents if on documents tab
                else if (tab === 'documents') {
                    loadDocuments();
                }
                // Load users if on users tab
                else if (tab === 'users') {
                    loadUsers();
                    loadUserStats();
                }
            } else {
                mainContent.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-hard-hat"></i>
                        </div>
                        <div class="empty-state-title">Coming Soon</div>
                        <div class="empty-state-text">This section is under development.</div>
                    </div>
                `;
            }
        }

        async function loadConversations() {
            const token = localStorage.getItem('authToken');
            const conversationsList = document.getElementById('conversationsList');
            
            try {
                const response = await fetch(`${API_URL}/api/chat/conversations`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const conversations = await response.json();
                    
                    if (conversations.length === 0) {
                        conversationsList.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-state-icon">
                                    <i class="fas fa-comments"></i>
                                </div>
                                <div class="empty-state-title">No conversations yet</div>
                                <div class="empty-state-text">Start a new conversation to get nutritional advice!</div>
                            </div>
                        `;
                    } else {
                        conversationsList.innerHTML = conversations.map(conv => `
                            <div class="conversation-card" onclick="openConversation('${conv.id}')">
                                <div class="conversation-info">
                                    <div class="conversation-title">${conv.title || 'Untitled Conversation'}</div>
                                    <div class="conversation-preview">Click to view messages...</div>
                                    <div class="conversation-meta">
                                        <span><i class="fas fa-clock"></i> ${new Date(conv.updatedAt).toLocaleDateString()}</span>
                                        <span><i class="fas fa-comment"></i> ${conv.messageCount || 0} messages</span>
                                    </div>
                                </div>
                                <div class="conversation-status ${conv.status}">
                                    ${conv.status}
                                </div>
                            </div>
                        `).join('');
                    }
                } else {
                    conversationsList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="empty-state-title">Error loading conversations</div>
                            <div class="empty-state-text">Please try again later.</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading conversations:', error);
                conversationsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="empty-state-title">Error loading conversations</div>
                        <div class="empty-state-text">${error.message}</div>
                    </div>
                `;
            }
        }

        async function createNewConversation() {
            const title = prompt('Enter a title for your new conversation:');
            if (!title) return;
            
            const token = localStorage.getItem('authToken');
            
            try {
                const response = await fetch(`${API_URL}/api/chat/conversations`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ title })
                });
                
                if (response.ok) {
                    const conversation = await response.json();
                    // Redirect to messages page with conversation ID
                    window.location.href = `messages.html?conversationId=${conversation.id}`;
                } else {
                    alert('Failed to create conversation. Please try again.');
                }
            } catch (error) {
                console.error('Error creating conversation:', error);
                alert('Error creating conversation: ' + error.message);
            }
        }

        function openConversation(conversationId) {
            // Redirect to messages page with conversation ID
            window.location.href = `messages.html?conversationId=${conversationId}`;
        }

        async function logout() {
            try {
                const token = localStorage.getItem('authToken');
                
                if (token) {
                    // Call logout API
                    await fetch(`${API_URL}/api/auth/logout`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });
                }
                
                // Clear local storage
                localStorage.removeItem('authToken');
                localStorage.removeItem('user');
                
                // Redirect to login
                window.location.href = 'signin.html';
            } catch (error) {
                console.error('Logout error:', error);
                // Still clear local storage and redirect on error
                localStorage.removeItem('authToken');
                localStorage.removeItem('user');
                window.location.href = 'signin.html';
            }
        }

        // Mobile responsive handling
        function handleResize() {
            const sidebar = document.getElementById('sidebar');
            const width = window.innerWidth;
            
            if (width <= 768) {
                sidebar.classList.remove('collapsed');
                // Add mobile-specific sidebar handling here
            }
        }

        window.addEventListener('resize', handleResize);
        handleResize(); // Initial check

        // App Config Management Functions
        let allConfigs = [];
        let currentConfig = null;
        let originalConfigValue = '';

        async function loadAppConfigs() {
            const token = localStorage.getItem('authToken');
            const configStatus = document.getElementById('configStatus');
            const configSelect = document.getElementById('configSelect');
            
            if (!configSelect) return; // Exit if not on app-config tab
            
            configStatus.innerHTML = `
                <div class="loading-state">
                    <i class="fas fa-spinner fa-spin"></i>
                    Loading configurations...
                </div>
            `;

            try {
                const response = await fetch(`${API_URL}/api/config`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    allConfigs = await response.json();
                    populateConfigDropdown();
                    configStatus.style.display = 'none';
                } else if (response.status === 401) {
                    configStatus.innerHTML = `
                        <div class="error-state">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h3>Authentication Required</h3>
                            <p>Please login with admin credentials to manage app configurations.</p>
                        </div>
                    `;
                } else {
                    configStatus.innerHTML = `
                        <div class="error-state">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h3>Failed to Load Configurations</h3>
                            <p>Please try again later.</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading app configs:', error);
                configStatus.innerHTML = `
                    <div class="error-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Connection Error</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        function populateConfigDropdown() {
            const configSelect = document.getElementById('configSelect');
            
            // Clear existing options except the first one
            configSelect.innerHTML = '<option value="">Select a configuration to edit...</option>';
            
            if (allConfigs.length === 0) {
                configSelect.innerHTML += '<option value="" disabled>No configurations found</option>';
                return;
            }

            // Sort configs by key name for better UX
            const sortedConfigs = [...allConfigs].sort((a, b) => a.key.localeCompare(b.key));
            
            sortedConfigs.forEach(config => {
                const option = document.createElement('option');
                option.value = config.key;
                option.textContent = `${config.key} (${config.value.length} chars)`;
                configSelect.appendChild(option);
            });
        }

        function getConfigBadge(key) {
            if (key.includes('prompt')) {
                return '<span class="badge badge-primary">AI Prompt</span>';
            } else if (key.includes('error') || key.includes('message')) {
                return '<span class="badge badge-warning">Message</span>';
            } else {
                return '<span class="badge badge-secondary">Config</span>';
            }
        }

        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substr(0, maxLength) + '...';
        }

        function formatDate(dateString) {
            if (!dateString) return 'Never';
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }

        async function editConfig(key) {
            const config = allConfigs.find(c => c.key === key);
            if (!config) {
                alert('Configuration not found!');
                return;
            }

            currentEditingConfig = config;
            
            // Populate modal
            document.getElementById('configKey').value = config.key;
            document.getElementById('configValue').value = config.value;
            document.getElementById('configCreatedAt').textContent = formatDate(config.createdAt);
            document.getElementById('configUpdatedAt').textContent = formatDate(config.updatedAt);
            document.getElementById('configUpdatedBy').textContent = config.updatedBy || 'System';
            
            updateCharCount();
            document.getElementById('configModal').style.display = 'flex';
        }

        function closeConfigModal() {
            document.getElementById('configModal').style.display = 'none';
            currentEditingConfig = null;
        }

        async function saveConfigChanges() {
            const token = localStorage.getItem('authToken');
            const key = document.getElementById('configKey').value;
            const value = document.getElementById('configValue').value.trim();

            if (!value) {
                alert('Configuration value cannot be empty!');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/config/${encodeURIComponent(key)}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ value: value })
                });

                if (response.ok) {
                    const result = await response.json();
                    
                    // Show success message
                    showNotification('Configuration updated successfully!', 'success');
                    
                    // Close modal and reload configs
                    closeConfigModal();
                    loadAppConfigs();
                    
                } else {
                    const error = await response.json();
                    showNotification(error.error || 'Failed to update configuration', 'error');
                }
            } catch (error) {
                console.error('Error saving config:', error);
                showNotification('Network error: ' + error.message, 'error');
            }
        }

        async function clearConfigCache() {
            const token = localStorage.getItem('authToken');
            
            if (!confirm('Are you sure you want to clear the configuration cache? This will force reload all configs from the database.')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/config/cache/clear`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    showNotification('Configuration cache cleared successfully!', 'success');
                } else {
                    const error = await response.json();
                    showNotification(error.error || 'Failed to clear cache', 'error');
                }
            } catch (error) {
                console.error('Error clearing cache:', error);
                showNotification('Network error: ' + error.message, 'error');
            }
        }

        async function resetConfig(key) {
            if (!confirm(`Are you sure you want to reset "${key}" to its default value? This action cannot be undone.`)) {
                return;
            }
            
            showNotification('Reset functionality not yet implemented', 'warning');
        }

        function filterConfigs(searchTerm) {
            const filteredConfigs = allConfigs.filter(config => 
                config.key.toLowerCase().includes(searchTerm.toLowerCase()) ||
                config.value.toLowerCase().includes(searchTerm.toLowerCase())
            );
            renderAppConfigs(filteredConfigs);
        }

        function updateCharCount() {
            const textarea = document.getElementById('configValue');
            const charCount = document.getElementById('charCount');
            if (textarea && charCount) {
                charCount.textContent = textarea.value.length;
            }
        }

        // Character counter for textarea
        document.addEventListener('input', function(e) {
            if (e.target.id === 'configValue') {
                updateCharCount();
            }
        });

        // Modal click outside to close
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('configModal');
            if (e.target === modal) {
                closeConfigModal();
            }
        });

        // Escape key to close modal
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeConfigModal();
            }
        });

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas ${getNotificationIcon(type)}"></i>
                    <span>${message}</span>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;

            // Add to page
            document.body.appendChild(notification);

            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        function onConfigSelect(configKey) {
            if (!configKey) {
                // Hide editor when no config selected
                document.getElementById('configEditor').style.display = 'none';
                document.getElementById('configInfo').style.display = 'none';
                currentConfig = null;
                return;
            }

            // Find the selected config
            currentConfig = allConfigs.find(c => c.key === configKey);
            if (!currentConfig) {
                showNotification('Configuration not found!', 'error');
                return;
            }

            // Store original value for reset functionality
            originalConfigValue = currentConfig.value;

            // Show and populate the editor
            document.getElementById('configEditor').style.display = 'block';
            document.getElementById('configInfo').style.display = 'flex';
            
            // Update editor header
            document.getElementById('editorTitle').textContent = `Edit: ${configKey}`;
            document.getElementById('editorBadge').innerHTML = getConfigBadge(configKey).replace('<span class="badge badge-', '').replace('</span>', '').replace('">', '');
            
            // Populate textarea
            const textarea = document.getElementById('configTextarea');
            textarea.value = currentConfig.value;
            textarea.focus();
            
            // Update character counter
            updateConfigCharCount();
            
            // Update info section
            document.getElementById('configCreatedDate').textContent = formatDate(currentConfig.createdAt);
            document.getElementById('configUpdatedDate').textContent = formatDate(currentConfig.updatedAt);
            document.getElementById('configLength').textContent = currentConfig.value.length;
        }

        async function saveCurrentConfig() {
            if (!currentConfig) {
                showNotification('No configuration selected!', 'error');
                return;
            }

            const textarea = document.getElementById('configTextarea');
            const newValue = textarea.value.trim();
            
            if (!newValue) {
                showNotification('Configuration value cannot be empty!', 'error');
                return;
            }

            if (newValue === currentConfig.value) {
                showNotification('No changes to save.', 'info');
                return;
            }

            const saveBtn = document.getElementById('saveBtn');
            const originalBtnText = saveBtn.innerHTML;
            
            // Show loading state
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';

            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch(`${API_URL}/api/config/${encodeURIComponent(currentConfig.key)}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ value: newValue })
                });

                if (response.ok) {
                    const result = await response.json();
                    
                    // Update current config and original value
                    currentConfig.value = newValue;
                    originalConfigValue = newValue;
                    
                    // Update the config in allConfigs array
                    const configIndex = allConfigs.findIndex(c => c.key === currentConfig.key);
                    if (configIndex !== -1) {
                        allConfigs[configIndex] = { ...currentConfig, updatedAt: new Date().toISOString() };
                    }
                    
                    // Update info display
                    document.getElementById('configUpdatedDate').textContent = formatDate(new Date().toISOString());
                    document.getElementById('configLength').textContent = newValue.length;
                    
                    // Update dropdown text
                    const selectOption = document.querySelector(`#configSelect option[value="${currentConfig.key}"]`);
                    if (selectOption) {
                        selectOption.textContent = `${currentConfig.key} (${newValue.length} chars)`;
                    }
                    
                    showNotification('Configuration saved successfully!', 'success');
                    
                } else {
                    const error = await response.json();
                    showNotification(error.error || 'Failed to save configuration', 'error');
                }
            } catch (error) {
                console.error('Error saving config:', error);
                showNotification('Network error: ' + error.message, 'error');
            } finally {
                // Reset button state
                saveBtn.disabled = false;
                saveBtn.innerHTML = originalBtnText;
            }
        }

        function resetConfig() {
            if (!currentConfig || !originalConfigValue) {
                showNotification('No configuration to reset!', 'error');
                return;
            }

            const textarea = document.getElementById('configTextarea');
            if (textarea.value === originalConfigValue) {
                showNotification('Configuration is already at its original value.', 'info');
                return;
            }

            if (confirm('Are you sure you want to reset this configuration to its original value? Any unsaved changes will be lost.')) {
                textarea.value = originalConfigValue;
                updateConfigCharCount();
                showNotification('Configuration reset to original value.', 'info');
            }
        }

        function updateConfigCharCount() {
            const textarea = document.getElementById('configTextarea');
            const charCounter = document.getElementById('charCounter');
            if (textarea && charCounter) {
                charCounter.textContent = textarea.value.length;
            }
        }

        // Add event listener for textarea character counting
        document.addEventListener('input', function(e) {
            if (e.target.id === 'configTextarea') {
                updateConfigCharCount();
            }
        });

        function getNotificationIcon(type) {
            switch (type) {
                case 'success': return 'fa-check-circle';
                case 'error': return 'fa-exclamation-circle';
                case 'warning': return 'fa-exclamation-triangle';
                default: return 'fa-info-circle';
            }
        }

        // User Management Functions
        let allUsers = [];
        let filteredUsers = [];

        async function loadUsers() {
            const token = localStorage.getItem('authToken');
            const usersTableBody = document.getElementById('usersTableBody');
            
            try {
                const response = await fetch(`${API_URL}/api/users`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 403) {
                    throw new Error('Access denied. Admin privileges required.');
                }
                
                if (!response.ok) {
                    throw new Error('Failed to load users');
                }

                allUsers = await response.json();
                filteredUsers = [...allUsers];
                renderUsersTable(filteredUsers);
                
                // Also load stats
                loadUserStats();
            } catch (error) {
                console.error('Error loading users:', error);
                const errorMessage = error.message.includes('Admin') 
                    ? 'You need administrator privileges to access user management.'
                    : 'Failed to load users. Please try again.';
                    
                usersTableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            <div class="error-message">
                                <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #e74c3c; margin-bottom: 10px;"></i>
                                <p>${errorMessage}</p>
                            </div>
                        </td>
                    </tr>
                `;
            }
        }

        async function loadUserStats() {
            const token = localStorage.getItem('authToken');
            
            try {
                const response = await fetch(`${API_URL}/api/users/stats`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to load user stats');
                }

                const stats = await response.json();
                document.getElementById('totalUsersCount').textContent = stats.totalUsers || 0;
                document.getElementById('patientsCount').textContent = stats.patientCount || 0;
                document.getElementById('nutritionistsCount').textContent = stats.nutritionistCount || 0;
                document.getElementById('adminsCount').textContent = stats.adminCount || 0;
            } catch (error) {
                console.error('Error loading user stats:', error);
            }
        }

        function renderUsersTable(users) {
            const usersTableBody = document.getElementById('usersTableBody');
            
            if (users.length === 0) {
                usersTableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            <div class="empty-state">
                                <i class="fas fa-users" style="font-size: 48px; color: #ddd; margin-bottom: 10px;"></i>
                                <p>No users found</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            usersTableBody.innerHTML = users.map(user => `
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="user-avatar" style="width: 35px; height: 35px; font-size: 14px;">
                                ${user.fullName ? user.fullName.charAt(0).toUpperCase() : user.email.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <div style="font-weight: 600;">${user.fullName || 'N/A'}</div>
                            </div>
                        </div>
                    </td>
                    <td>${user.email}</td>
                    <td>
                        <span class="user-role-badge role-${user.role}">
                            ${user.role}
                        </span>
                    </td>
                    <td>${user.phoneNumber || 'N/A'}</td>
                    <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                    <td>
                        <div class="user-actions-btns">
                            ${user.role !== 'admin' ? `
                                <button class="user-action-btn make-admin-btn" onclick="updateUserRole('${user.id}', 'admin')">
                                    <i class="fas fa-crown"></i>
                                    Make Admin
                                </button>
                            ` : user.role === 'admin' ? `
                                <button class="user-action-btn remove-admin-btn" onclick="updateUserRole('${user.id}', 'patient')">
                                    <i class="fas fa-user"></i>
                                    Remove Admin
                                </button>
                            ` : ''}
                            <button class="user-action-btn delete-user-btn" onclick="deleteUser('${user.id}')">
                                <i class="fas fa-trash"></i>
                                Delete
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function searchUsers(searchTerm) {
            if (!searchTerm || searchTerm.trim() === '') {
                filteredUsers = [...allUsers];
            } else {
                const term = searchTerm.toLowerCase();
                filteredUsers = allUsers.filter(user => 
                    (user.fullName && user.fullName.toLowerCase().includes(term)) ||
                    user.email.toLowerCase().includes(term) ||
                    (user.phoneNumber && user.phoneNumber.includes(term)) ||
                    user.role.toLowerCase().includes(term)
                );
            }
            renderUsersTable(filteredUsers);
        }

        async function updateUserRole(userId, newRole) {
            const confirmMsg = newRole === 'admin' 
                ? 'Are you sure you want to make this user an admin?' 
                : 'Are you sure you want to remove admin privileges from this user?';
            
            if (!confirm(confirmMsg)) {
                return;
            }

            const token = localStorage.getItem('authToken');
            
            try {
                const response = await fetch(`${API_URL}/api/users/${userId}/role`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ role: newRole })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to update user role');
                }

                const result = await response.json();
                showNotification(`User role updated to ${newRole}`, 'success');
                loadUsers();
                loadUserStats();
            } catch (error) {
                console.error('Error updating user role:', error);
                showNotification(error.message || 'Failed to update user role', 'error');
            }
        }

        async function deleteUser(userId) {
            if (!confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
                return;
            }

            const token = localStorage.getItem('authToken');
            
            try {
                const response = await fetch(`${API_URL}/api/users/${userId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to delete user');
                }

                showNotification('User deleted successfully', 'success');
                loadUsers();
                loadUserStats();
            } catch (error) {
                console.error('Error deleting user:', error);
                showNotification(error.message || 'Failed to delete user', 'error');
            }
        }

        // Documents Management Functions
        async function loadDocuments() {
            const token = localStorage.getItem('authToken');
            const documentsList = document.getElementById('documentsList');
            
            try {
                const response = await fetch(`${API_URL}/api/document/list`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayDocuments(data.documents || []);
                } else {
                    documentsList.innerHTML = '<div class="error-state"><i class="fas fa-exclamation-circle"></i><p>Failed to load documents</p></div>';
                }
            } catch (error) {
                console.error('Error loading documents:', error);
                documentsList.innerHTML = '<div class="error-state"><i class="fas fa-exclamation-circle"></i><p>Error loading documents</p></div>';
            }
        }

        function displayDocuments(documents) {
            const documentsList = document.getElementById('documentsList');
            
            if (documents.length === 0) {
                documentsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <h3>No documents found</h3>
                        <p>Upload your first document to get started</p>
                    </div>
                `;
                return;
            }

            documentsList.innerHTML = `
                <div class="documents-list">
                    ${documents.map(doc => {
                        const getIconForType = (type) => {
                            switch(type) {
                                case 'diet_plan': return 'fa-utensils';
                                case 'workout_plan': return 'fa-dumbbell';
                                case 'medical_report': return 'fa-file-medical';
                                default: return 'fa-file-alt';
                            }
                        };
                        
                        return `
                        <div class="document-list-item">
                            <div class="document-list-left">
                                <div class="document-icon">
                                    <i class="fas ${getIconForType(doc.documentType)}"></i>
                                </div>
                                <div class="document-info">
                                    <h3>${doc.name} <span class="document-type-badge ${doc.documentType.replace('_', '-')}">${doc.documentType.replace('_', ' ')}</span></h3>
                                    ${doc.description ? `<p class="document-description">${doc.description}</p>` : ''}
                                    <div class="document-meta">
                                        <span><i class="fas fa-file"></i> ${formatFileSize(doc.fileSize)}</span>
                                        <span><i class="fas fa-calendar"></i> ${formatDate(doc.createdAt)}</span>
                                        <span class="status-badge ${doc.status}">${doc.status}</span>
                                    </div>
                                    ${doc.tags && doc.tags.length > 0 ? `
                                        <div class="document-tags">
                                            ${doc.tags.filter(tag => tag.toLowerCase() !== 'i apologize').map(tag => `<span class="tag">${tag}</span>`).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="document-actions">
                                ${doc.content ? `<button type="button" class="icon-btn view" onclick="viewDocumentContent('${doc.id}')" data-tooltip="View Content"><i class="fas fa-eye"></i></button>` : ''}
                                <button type="button" class="icon-btn edit" onclick="editDocument('${doc.id}')" data-tooltip="Edit"><i class="fas fa-edit"></i></button>
                                <button type="button" class="icon-btn download" onclick="downloadDocument('${doc.id}', '${doc.originalFilename}')" data-tooltip="Download"><i class="fas fa-download"></i></button>
                                <button type="button" class="icon-btn delete" onclick="deleteDocument('${doc.id}')" data-tooltip="Delete"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    `}).join('')}
                </div>
            `;
        }

        function showUploadModal() {
            document.getElementById('uploadSection').style.display = 'block';
        }

        function hideUploadModal() {
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('documentUploadForm').reset();
        }

        async function uploadDocument(event) {
            event.preventDefault();
            const token = localStorage.getItem('authToken');
            
            const formData = new FormData();
            const fileInput = document.getElementById('docFile');
            const file = fileInput.files[0];
            
            formData.append('file', file);
            formData.append('name', document.getElementById('docName').value);
            formData.append('documentType', document.getElementById('docType').value);
            formData.append('description', document.getElementById('docDescription').value);
            formData.append('isPublic', document.getElementById('docVisibility').value);
            
            const tags = document.getElementById('docTags').value;
            if (tags) {
                tags.split(',').forEach(tag => formData.append('tags', tag.trim()));
            }

            try {
                showNotification('Uploading document...', 'info');
                
                const response = await fetch(`${API_URL}/api/document/upload`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });

                if (response.ok) {
                    showNotification('Document uploaded successfully!', 'success');
                    hideUploadModal();
                    loadDocuments();
                } else {
                    const error = await response.text();
                    showNotification(`Upload failed: ${error}`, 'error');
                }
            } catch (error) {
                console.error('Upload error:', error);
                showNotification('Error uploading document', 'error');
            }
        }

        async function viewDocumentContent(documentId) {
            const token = localStorage.getItem('authToken');
            
            try {
                const response = await fetch(`${API_URL}/api/document/${documentId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const doc = await response.json();
                    // Create a modal to show content
                    const modal = document.createElement('div');
                    modal.className = 'modal';
                    modal.innerHTML = `
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3>${doc.name} - Content</h3>
                                <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
                            </div>
                            <div class="modal-body">
                                <pre style="white-space: pre-wrap; max-height: 400px; overflow-y: auto;">${doc.content || 'No content available'}</pre>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(modal);
                    modal.style.display = 'flex';
                } else {
                    showNotification('Failed to load document content', 'error');
                }
            } catch (error) {
                console.error('Error viewing content:', error);
                showNotification('Error loading content', 'error');
            }
        }

        async function downloadDocument(documentId, filename) {
            const token = localStorage.getItem('authToken');
            
            try {
                const response = await fetch(`${API_URL}/api/document/${documentId}/download`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                } else {
                    showNotification('Failed to download document', 'error');
                }
            } catch (error) {
                console.error('Download error:', error);
                showNotification('Error downloading document', 'error');
            }
        }

        async function deleteDocument(documentId) {
            if (!confirm('Are you sure you want to delete this document?')) {
                return;
            }

            const token = localStorage.getItem('authToken');
            
            try {
                const response = await fetch(`${API_URL}/api/document/${documentId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    showNotification('Document deleted successfully', 'success');
                    loadDocuments();
                } else {
                    showNotification('Failed to delete document', 'error');
                }
            } catch (error) {
                console.error('Delete error:', error);
                showNotification('Error deleting document', 'error');
            }
        }

        let currentEditDocumentId = null;

        async function editDocument(documentId) {
            const token = localStorage.getItem('authToken');
            
            try {
                // Fetch current document data
                const response = await fetch(`${API_URL}/api/document/${documentId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const doc = await response.json();
                    
                    // DEBUG: Log document data
                    console.log('Document data received:', doc);
                    console.log('Document content:', doc.content);
                    console.log('Content type:', typeof doc.content);
                    console.log('Content length:', doc.content ? doc.content.length : 'null/undefined');
                    
                    // Store document ID for update
                    currentEditDocumentId = documentId;
                    
                    // Populate form fields
                    document.getElementById('editDocName').value = doc.name || '';
                    document.getElementById('editDocType').value = doc.documentType || '';
                    document.getElementById('editDocDescription').value = doc.description || '';
                    document.getElementById('editDocContent').value = doc.content || '';
                    document.getElementById('editDocTags').value = doc.tags ? doc.tags.join(', ') : '';
                    document.getElementById('editDocVisibility').value = doc.isPublic ? 'true' : 'false';
                    
                    // Show edit modal
                    document.getElementById('editSection').style.display = 'block';
                } else {
                    showNotification('Failed to load document for editing', 'error');
                }
            } catch (error) {
                console.error('Edit error:', error);
                showNotification('Error loading document for editing', 'error');
            }
        }

        function hideEditModal() {
            document.getElementById('editSection').style.display = 'none';
            document.getElementById('documentEditForm').reset();
            currentEditDocumentId = null;
        }

        async function updateDocument(event) {
            event.preventDefault();
            
            if (!currentEditDocumentId) {
                showNotification('No document selected for editing', 'error');
                return;
            }

            const token = localStorage.getItem('authToken');
            
            // Collect form data
            const name = document.getElementById('editDocName').value;
            const documentType = document.getElementById('editDocType').value;
            const description = document.getElementById('editDocDescription').value;
            const content = document.getElementById('editDocContent').value;
            const tagsInput = document.getElementById('editDocTags').value;
            const isPublic = document.getElementById('editDocVisibility').value === 'true';
            
            const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag) : null;
            
            const updateData = {
                name: name,
                documentType: documentType,
                description: description || null,
                content: content || null,
                tags: tags,
                isPublic: isPublic
            };

            try {
                const response = await fetch(`${API_URL}/api/document/${currentEditDocumentId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });

                if (response.ok) {
                    showNotification('Document updated successfully', 'success');
                    hideEditModal();
                    loadDocuments();
                } else {
                    const error = await response.text();
                    showNotification(`Update failed: ${error}`, 'error');
                }
            } catch (error) {
                console.error('Update error:', error);
                showNotification('Error updating document', 'error');
            }
        }

        function formatFileSize(bytes) {
            if (!bytes) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        // Risha Editor Functions
        let rishaEditor;
        let rishaOriginalContent = '';
        let rishaUnsavedChanges = false;

        async function loadRishaPrompt() {
            const token = localStorage.getItem('authToken');
            const editor = document.getElementById('rishaPromptEditor');
            const charCount = document.getElementById('rishaCharCount');
            const statusText = document.querySelector('#rishaEditorStatus .status-text');
            const saveBtn = document.getElementById('saveRishaBtn');
            
            if (!editor) return;

            try {
                statusText.textContent = 'Loading...';
                editor.classList.add('loading');
                editor.disabled = true;

                const response = await fetch(`${API_URL}/api/config/risha_prompt`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const config = await response.json();
                    rishaOriginalContent = config.value || '';
                    editor.value = rishaOriginalContent;
                    updateCharCount();
                    statusText.textContent = 'Ready to edit';
                    
                    // Update last saved timestamp
                    if (config.updatedAt) {
                        document.getElementById('lastSaved').textContent = 
                            `Last saved: ${formatDate(config.updatedAt)}`;
                    }
                } else if (response.status === 404) {
                    // Config doesn't exist yet
                    rishaOriginalContent = '';
                    editor.value = '';
                    statusText.textContent = 'Ready to edit (new prompt)';
                } else {
                    throw new Error('Failed to load Risha prompt');
                }
            } catch (error) {
                console.error('Error loading Risha prompt:', error);
                statusText.textContent = 'Error loading prompt';
                editor.classList.add('error');
                showNotification('Failed to load Risha prompt', 'error');
            } finally {
                editor.classList.remove('loading');
                editor.disabled = false;
                rishaUnsavedChanges = false;
                updateSaveButton();
            }
        }

        async function saveRishaPrompt() {
            const token = localStorage.getItem('authToken');
            const editor = document.getElementById('rishaPromptEditor');
            const statusText = document.querySelector('#rishaEditorStatus .status-text');
            const saveBtn = document.getElementById('saveRishaBtn');
            const content = editor.value;
            
            if (!editor || content === rishaOriginalContent) return;

            try {
                statusText.textContent = 'Saving...';
                editor.classList.add('loading');
                saveBtn.disabled = true;

                const response = await fetch(`${API_URL}/api/config/risha_prompt`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ value: content })
                });

                if (response.ok) {
                    rishaOriginalContent = content;
                    rishaUnsavedChanges = false;
                    updateSaveButton();
                    
                    editor.classList.add('saved');
                    setTimeout(() => editor.classList.remove('saved'), 2000);
                    
                    statusText.textContent = 'Saved successfully';
                    document.getElementById('lastSaved').textContent = 
                        `Last saved: ${new Date().toLocaleString()}`;
                    
                    showNotification('Risha prompt saved successfully!', 'success');
                } else {
                    throw new Error('Failed to save prompt');
                }
            } catch (error) {
                console.error('Error saving Risha prompt:', error);
                statusText.textContent = 'Error saving prompt';
                editor.classList.add('error');
                setTimeout(() => editor.classList.remove('error'), 3000);
                showNotification('Failed to save Risha prompt', 'error');
            } finally {
                editor.classList.remove('loading');
                saveBtn.disabled = false;
            }
        }

        function updateCharCount() {
            const editor = document.getElementById('rishaPromptEditor');
            const charCount = document.getElementById('rishaCharCount');
            if (editor && charCount) {
                const count = editor.value.length;
                charCount.textContent = `${count.toLocaleString()} characters`;
            }
        }

        function updateSaveButton() {
            const saveBtn = document.getElementById('saveRishaBtn');
            if (saveBtn) {
                saveBtn.disabled = !rishaUnsavedChanges;
                // Add visual feedback
                if (rishaUnsavedChanges) {
                    saveBtn.style.background = 'var(--primary-color)';
                    saveBtn.style.transform = 'none';
                } else {
                    saveBtn.style.background = '#ccc';
                }
            }
        }

        function formatText(format) {
            const editor = document.getElementById('rishaPromptEditor');
            if (!editor) return;

            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const selectedText = editor.value.substring(start, end);
            
            if (!selectedText) return;

            let formattedText = selectedText;
            switch (format) {
                case 'bold':
                    formattedText = `**${selectedText}**`;
                    break;
                case 'italic':
                    formattedText = `*${selectedText}*`;
                    break;
            }

            editor.value = editor.value.substring(0, start) + formattedText + editor.value.substring(end);
            editor.focus();
            editor.setSelectionRange(start, start + formattedText.length);
            
            rishaUnsavedChanges = true;
            updateSaveButton();
            updateCharCount();
        }

        function insertTemplate() {
            const editor = document.getElementById('rishaPromptEditor');
            if (!editor) return;

            const template = `You are Risha, NutrishaAI's helpful and knowledgeable nutrition assistant.

Your role:
- Provide accurate, evidence-based nutrition and health advice
- Be supportive and encouraging to users on their health journey  
- Ask clarifying questions when needed to give personalized guidance
- Always recommend consulting healthcare professionals for medical concerns

Guidelines:
- Use a friendly, conversational tone
- Keep responses concise but informative
- Focus on sustainable, realistic lifestyle changes
- Acknowledge cultural and personal food preferences
- Never provide medical diagnoses or replace professional medical advice

Remember to be empathetic and understanding of each user's unique situation and goals.`;

            const start = editor.selectionStart;
            editor.value = editor.value.substring(0, start) + template + editor.value.substring(start);
            editor.focus();
            editor.setSelectionRange(start, start + template.length);
            
            rishaUnsavedChanges = true;
            updateSaveButton();
            updateCharCount();
        }

        // Setup Risha editor event listeners
        function setupRishaEditor() {
            setTimeout(() => {
                const editor = document.getElementById('rishaPromptEditor');
                if (editor) {
                    // Remove existing listeners to avoid duplicates
                    editor.removeEventListener('input', handleRishaInput);
                    editor.removeEventListener('keydown', handleRishaKeydown);
                    
                    // Add event listeners
                    editor.addEventListener('input', handleRishaInput);
                    editor.addEventListener('keydown', handleRishaKeydown);
                }
            }, 100);
        }

        function handleRishaInput() {
            const editor = document.getElementById('rishaPromptEditor');
            if (editor) {
                rishaUnsavedChanges = editor.value !== rishaOriginalContent;
                updateSaveButton();
                updateCharCount();
            }
        }

        function handleRishaKeydown(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                if (rishaUnsavedChanges) {
                    saveRishaPrompt();
                }
            }
        }
    </script>
</body>
</html>