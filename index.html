<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutrishaAI - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .btn-logout {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: rgba(255,255,255,0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .welcome-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .welcome-section h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .welcome-section p {
            color: #666;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .card-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .card-description {
            color: #666;
            font-size: 14px;
        }

        .chat-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            border-bottom: 1px solid #e1e1e1;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 12px;
            background: #e3e3e3;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 14px;
        }

        .chat-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-send {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .btn-send:hover {
            transform: scale(1.05);
        }

        .btn-send:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .auth-prompt {
            background: white;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .auth-prompt h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .auth-prompt p {
            color: #666;
            margin-bottom: 30px;
        }

        .auth-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .btn-auth {
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            transition: transform 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-auth:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">ü•ó NutrishaAI</div>
            <div class="user-info">
                <span id="userName">Loading...</span>
                <button class="btn-logout" onclick="logout()">Logout</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Auth Prompt (shown when not logged in) -->
        <div id="authPrompt" class="auth-prompt hidden">
            <h2>Welcome to NutrishaAI</h2>
            <p>Your AI-powered nutrition assistant. Please sign in to continue.</p>
            <div class="auth-buttons">
                <a href="signin.html" class="btn-auth btn-primary">Sign In</a>
                <a href="signup.html" class="btn-auth btn-secondary">Sign Up</a>
            </div>
        </div>

        <!-- Dashboard Content (shown when logged in) -->
        <div id="dashboardContent" class="hidden">
            <div class="welcome-section">
                <h1>Welcome back, <span id="userFullName">User</span>!</h1>
                <p>Here's your nutrition dashboard for today</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">0</div>
                    <div class="stat-label">Active Conversations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">0</div>
                    <div class="stat-label">Diet Plans</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">0</div>
                    <div class="stat-label">Health Metrics</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">0</div>
                    <div class="stat-label">Meal Logs Today</div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-card" onclick="alert('Diet Plans feature coming soon!')">
                    <div class="card-icon">üìã</div>
                    <div class="card-title">Diet Plans</div>
                    <div class="card-description">View and manage your personalized diet plans</div>
                </div>
                <div class="dashboard-card" onclick="alert('Health Tracking feature coming soon!')">
                    <div class="card-icon">üí™</div>
                    <div class="card-title">Health Tracking</div>
                    <div class="card-description">Monitor your health metrics and progress</div>
                </div>
                <div class="dashboard-card" onclick="alert('Meal Logger feature coming soon!')">
                    <div class="card-icon">üçΩÔ∏è</div>
                    <div class="card-title">Meal Logger</div>
                    <div class="card-description">Log your meals and track nutrition</div>
                </div>
                <div class="dashboard-card" onclick="alert('Reports feature coming soon!')">
                    <div class="card-icon">üìä</div>
                    <div class="card-title">Reports</div>
                    <div class="card-description">View detailed nutrition and health reports</div>
                </div>
            </div>

            <div class="chat-section">
                <div class="chat-header">
                    <h3>AI Nutrition Assistant</h3>
                    <p style="color: #666; font-size: 14px; margin-top: 5px;">Ask me anything about nutrition and health!</p>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="message">
                        <div class="message-bubble">
                            üëã Hello! I'm your AI nutrition assistant. How can I help you with your health and nutrition goals today?
                        </div>
                    </div>
                </div>
                <div class="chat-input-container">
                    <input 
                        type="text" 
                        class="chat-input" 
                        id="chatInput"
                        placeholder="Type your message..."
                        onkeypress="if(event.key === 'Enter') sendMessage()"
                    >
                    <button class="btn-send" onclick="sendMessage()">Send</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5133';
        let currentUser = null;
        let authToken = null;

        // Check authentication on page load
        window.addEventListener('DOMContentLoaded', () => {
            checkAuth();
        });

        function checkAuth() {
            authToken = localStorage.getItem('auth_token');
            const userStr = localStorage.getItem('user');
            
            if (authToken && userStr) {
                try {
                    currentUser = JSON.parse(userStr);
                    showDashboard();
                } catch (e) {
                    showAuthPrompt();
                }
            } else {
                showAuthPrompt();
            }
        }

        function showAuthPrompt() {
            document.getElementById('authPrompt').classList.remove('hidden');
            document.getElementById('dashboardContent').classList.add('hidden');
        }

        function showDashboard() {
            document.getElementById('authPrompt').classList.add('hidden');
            document.getElementById('dashboardContent').classList.remove('hidden');
            
            // Update user info
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.email || 'User';
                document.getElementById('userFullName').textContent = currentUser.fullName || currentUser.email || 'User';
            }
            
            // Load dashboard data
            loadDashboardData();
        }

        async function loadDashboardData() {
            // This would load real data from the API
            // For now, we'll just show placeholder data
            console.log('Loading dashboard data...');
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to chat
            addMessageToChat(message, 'user');
            
            // Clear input
            input.value = '';
            input.disabled = true;
            
            // Send to API (mock response for now)
            setTimeout(() => {
                const responses = [
                    "That's a great question about nutrition! Based on current guidelines, a balanced diet should include a variety of fruits, vegetables, whole grains, and lean proteins.",
                    "I understand your concern. Maintaining proper nutrition is essential for overall health. Would you like specific recommendations based on your dietary preferences?",
                    "Excellent point! Hydration is crucial - aim for at least 8 glasses of water daily, and remember that your needs may increase with physical activity.",
                    "That's interesting! Many people don't realize that timing of meals can be as important as what you eat. Consider spacing meals 3-4 hours apart for optimal energy."
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                addMessageToChat(randomResponse, 'ai');
                input.disabled = false;
                input.focus();
            }, 1000);
        }

        function addMessageToChat(message, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'message-bubble';
            bubbleDiv.textContent = message;
            
            messageDiv.appendChild(bubbleDiv);
            messagesContainer.appendChild(messageDiv);
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        async function logout() {
            // Call logout API
            if (authToken) {
                try {
                    await fetch(`${API_URL}/api/auth/logout`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        }
                    });
                } catch (error) {
                    console.error('Logout error:', error);
                }
            }
            
            // Clear local storage
            localStorage.removeItem('auth_token');
            localStorage.removeItem('refresh_token');
            localStorage.removeItem('user');
            
            // Redirect to signin
            window.location.href = 'signin.html';
        }
    </script>
</body>
</html>